@if (IsLoading)
{
    <div class="text-center mt-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}
else
{
    <div class="row mb-4">
        <div class="col-md-4">
            <select class="form-select"
                    value="@SelectedCourseId"
                    @onchange="CourseChanged">
                @foreach (var c in Courses)
                {
                    <option value="@c.RowKey">@c.CourseName</option>
                }
            </select>
        </div>
    </div>

    <div class="d-flex justify-content-end mb-4">
        <button class="btn btn-primary" @onclick="CreateNewTest">
            <i class="bi bi-plus-lg"></i> Create New Test
        </button>
    </div>

    @if (AllTests.Count == 0)
    {
        <div class="alert alert-info text-center">
            No tests found.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table align-middle table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Status</th>
                        <th>Title</th>
                        <th>Questions</th>
                        <th>Points</th>
                        <th>Last Updated</th>
                        <th style="width:150px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var test in AllTests)
                    {
                        <tr>
                            <td>
                                @if (!test.IsPublished)
                                {
                                    <span class="badge bg-warning">Draft</span>
                                }
                                else
                                {
                                    @if (test.IsOpen)
                                    {
                                        <span class="badge bg-success">Open</span>
                                    }
                                    else 
                                    {
                                        <span class="badge bg-dark">Closed</span>
                                    }
                                }
                            </td>
                            <td>@test.Title</td>
                            <td>@test.QuestionCount</td>
                            <td>@test.TotalPoints</td>
                            <td>@test.LastModifiedDate.ToLocalTime().ToString("MMM d, yyyy")</td>
                            <td class="text-nowrap">

                                <button class="btn btn-outline-primary btn-sm me-2"
                                        title="View submissions"
                                        @onclick="() => ViewSubmissions(test.RowKey)">
                                    <i class="bi bi-list-check"></i>
                                </button>

                                <button class="btn btn-outline-secondary btn-sm"
                                        title="Edit test"
                                        @onclick="() => EditTest(test.RowKey)">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
}